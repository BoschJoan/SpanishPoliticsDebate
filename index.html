<!DOCTYPE html>

<meta charset="utf-8">
<link rel="stylesheet" href="stylesheets/spiderStyle.css">

<style>
body {
  padding: 20px;
}
.radar-chart .area {
  fill-opacity: 0.7;
}
.radar-chart.focus .area {
  fill-opacity: 0.3;
}
.radar-chart.focus .area.focused {
  fill-opacity: 0.9;
}
.year.label {
  font: 500 76px "Helvetica Neue";
  fill: #aaa;
}
.overlay {
  fill: none;
  pointer-events: all;
  cursor: ns-resize;
}
</style>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="spiderChart.js"></script>

<span></span>

<script>

var data = [[
  {
    className: 'Cis',
    axes: [
      {axis: "Paro", value: [ 0.43576974,  0.22539443,  0.54502393,  0.79838492,  0.20642203,
        0.29669951,  0.21037198,  0.08444263,  0.68667565,  0.1857846 ,
        0.28016347,  0.75029049,  0.15582216,  0.40146824,  0.07002429,
        0.13959392,  0.49101051,  0.36822371,  0.71266338,  0.73531408,
        0.51622113,  0.30458786,  0.87110492,  0.98177658,  0.21221246,
        0.24546688,  0.55499511,  0.27839374,  0.49052021,  0.06146668,
        0.14322153,  0.16297493,  0.17713097,  0.58048719,  0.91475175,
        0.48454694,  0.90253667,  0.49952632,  0.39769632,  0.2780534 ,
        0.74213666,  0.49595378,  0.70236801,  0.85421484,  0.81317984,
        0.1581234 ,  0.09472646,  0.23437449]}, 
      {axis: "Corrupción", value: [ 0.43190062,  0.58460687,  0.20638539,  0.91628924,  0.48894542,
        0.95400242,  0.41397049,  0.86027999,  0.15838867,  0.43288431,
        0.00771114,  0.69206193,  0.78138585,  0.32960984,  0.52700829,
        0.44083783,  0.17373471,  0.8590489 ,  0.69426142,  0.39319476,
        0.32820808,  0.56384224,  0.03178064,  0.60135779,  0.63455682,
        0.32128176,  0.63873134,  0.893324  ,  0.34365018,  0.15623528,
        0.59029194,  0.9325293 ,  0.58730719,  0.98494008,  0.45419383,
        0.05064074,  0.20090492,  0.04788159,  0.53048691,  0.45966104,
        0.72906458,  0.93312459,  0.30042607,  0.5659394 ,  0.64841154,
        0.64765096,  0.46858487,  0.03076566]}, 
      {axis: "Energía", value: [ 0.40177952,  0.79024068,  0.99141059,  0.20779627,  0.51451824,
        0.03307404,  0.69778612,  0.16682322,  0.71428167,  0.1447937 ,
        0.84910525,  0.53372257,  0.35457658,  0.21281073,  0.86959921,
        0.81515429,  0.46059425,  0.08524705,  0.59757921,  0.79129382,
        0.65693491,  0.78417857,  0.91756021,  0.13995239,  0.80870173,
        0.5811276 ,  0.87231039,  0.74460438,  0.51294842,  0.57556176,
        0.23334308,  0.50089273,  0.89735247,  0.94528088,  0.27583497,
        0.76175325,  0.83894214,  0.24543967,  0.21117524,  0.95704659,
        0.18597747,  0.39996971,  0.46683251,  0.89482838,  0.49049351,
        0.78107144,  0.03982923,  0.06961487]},  
      {axis: "Elecciones", value: [ 0.96012658,  0.02814684,  0.32460039,  0.18220814,  0.09198739,
        0.9386627 ,  0.92597134,  0.9826776 ,  0.65712095,  0.14831244,
        0.00234605,  0.76171056,  0.23690931,  0.54445692,  0.57721851,
        0.661966  ,  0.47547116,  0.11942861,  0.8925608 ,  0.14552466,
        0.71791229,  0.57812829,  0.16870286,  0.23956778,  0.12990228,
        0.35935787,  0.17047378,  0.72718462,  0.15159894,  0.34700476,
        0.53684813,  0.06489614,  0.19281944,  0.98958306,  0.96413693,
        0.333371  ,  0.69746293,  0.62741456,  0.9194504 ,  0.58589308,
        0.95203985,  0.35989645,  0.26127095,  0.80675916,  0.31814966,
        0.88753964,  0.17008899,  0.11388037]},  
      {axis: "Otros", value: [ 0.11724414,  0.72709624,  0.13927611,  0.54910718,  0.35512248,
        0.41398835,  0.83705713,  0.03327983,  0.74769225,  0.06205436,
        0.32787882,  0.40818892,  0.12975646,  0.24710744,  0.63079412,
        0.04099544,  0.48832464,  0.87943818,  0.63965879,  0.77907783,
        0.05046295,  0.24860224,  0.78117253,  0.91660268,  0.84619721,
        0.67472439,  0.66521545,  0.60893103,  0.69718127,  0.14132625,
        0.84875822,  0.36948256,  0.06042914,  0.80125816,  0.14921075,
        0.59977279,  0.0072982 ,  0.74159605,  0.68308103,  0.84344379,
        0.33407124,  0.56236105,  0.35541084,  0.86283466,  0.16588375,
        0.69907572,  0.31334153,  0.38003444]}
    ]
  },
  {
    className: 'Congreso',
    axes: [
      {axis: "Paro", value: [ 0.38050482,  0.63798876,  0.08149029,  0.52516923,  0.39061811,
        0.40206022,  0.72747645,  0.58045803,  0.30971751,  0.219468  ,
        0.65867855,  0.63562599,  0.26178935,  0.73608776,  0.38487069,
        0.82151929,  0.86307971,  0.43049165,  0.84401412,  0.66847911,
        0.5931749 ,  0.69422702,  0.14491478,  0.53271419,  0.1918447 ,
        0.88047538,  0.1309958 ,  0.85242538,  0.70670677,  0.6518751 ,
        0.5124138 ,  0.38299046,  0.00818019,  0.69471062,  0.86730325,
        0.48580523,  0.93862407,  0.32270879,  0.40276319,  0.38430785,
        0.38581314,  0.19992891,  0.04707399,  0.23793933,  0.95412642,
        0.30151633,  0.13054556,  0.88728168]}, 
      {axis: "Corrupción", value: [ 0.87780719,  0.65858881,  0.43665233,  0.9573972 ,  0.7887206 ,
        0.96148536,  0.98300163,  0.51012489,  0.34309143,  0.50988989,
        0.88964179,  0.14229083,  0.56601022,  0.53430372,  0.68375991,
        0.3908623 ,  0.90439743,  0.42848285,  0.20478383,  0.92170059,
        0.50487572,  0.40580273,  0.35793338,  0.84871119,  0.64554598,
        0.40334538,  0.63770832,  0.73922056,  0.79416171,  0.42757385,
        0.51547384,  0.86667473,  0.33744692,  0.1613093 ,  0.72430268,
        0.77836183,  0.39638134,  0.45811875,  0.51410033,  0.35034843,
        0.30305349,  0.74974324,  0.21157716,  0.23637584,  0.05462498,
        0.69647893,  0.67558614,  0.21267347]}, 
      {axis: "Energía", value: [ 0.97754192,  0.19734053,  0.14711295,  0.97692248,  0.55489254,
        0.91748743,  0.00363261,  0.03682484,  0.85960085,  0.10324259,
        0.5002955 ,  0.18154327,  0.61874232,  0.02941872,  0.05929917,
        0.49101951,  0.60898431,  0.2388366 ,  0.97467305,  0.30362578,
        0.87463851,  0.12631224,  0.848251  ,  0.13432286,  0.79242264,
        0.74013843,  0.52413707,  0.04003345,  0.99972338,  0.0548086 ,
        0.0331527 ,  0.85545664,  0.3134309 ,  0.00493241,  0.66054713,
        0.99651859,  0.60443297,  0.5677533 ,  0.36310094,  0.45129632,
        0.87592655,  0.00104377,  0.86426809,  0.61711118,  0.6239164 ,
        0.79613537,  0.80945548,  0.81164151]},  
      {axis: "Elecciones", value: [ 0.47942607,  0.6114943 ,  0.05029148,  0.40839424,  0.46331258,
        0.47285502,  0.08718071,  0.96027679,  0.83415071,  0.36759498,
        0.50740996,  0.87967758,  0.54609756,  0.30878559,  0.98740978,
        0.76645803,  0.04110408,  0.11957776,  0.25882724,  0.99027115,
        0.82745006,  0.35048828,  0.65987156,  0.19119012,  0.25218828,
        0.32834533,  0.80564316,  0.43013158,  0.18122281,  0.95243349,
        0.87528376,  0.11656217,  0.42330797,  0.34155187,  0.74943756,
        0.00255036,  0.07831524,  0.04753933,  0.1363517 ,  0.54553897,
        0.6511904 ,  0.34198749,  0.08438   ,  0.10025848,  0.2741163 ,
        0.40657393,  0.58566448,  0.89384741]},  
      {axis: "Otros", value: [ 0.56839359,  0.02443212,  0.51238557,  0.42560482,  0.1604566 ,
        0.17486153,  0.08902554,  0.97968294,  0.82748502,  0.19875178,
        0.372768  ,  0.28176262,  0.8173254 ,  0.38712459,  0.66111268,
        0.94746654,  0.16512915,  0.34221738,  0.70237661,  0.8569156 ,
        0.94263947,  0.17565487,  0.93151644,  0.60709414,  0.43124308,
        0.68982149,  0.71917051,  0.56711154,  0.90323926,  0.09716954,
        0.63031956,  0.09414028,  0.96566488,  0.82131187,  0.42144822,
        0.33992285,  0.03223737,  0.83263524,  0.01015888,  0.74287268,
        0.70395981,  0.97555013,  0.2231783 ,  0.28073946,  0.30262597,
        0.02936769,  0.87332851,  0.50507442]}
    ]
  }
],125];

var notInterrupted = true;

var varIni = data[1];
var periods = [];
for (i = 0; i < data[0][0].axes[0].value.length; i++) {
	periods.push(varIni + i);
}

var firstYear = Math.floor(varIni / 12) + 2000;
if ((varIni + periods.length - 1) % 12 == 0) {
	var lastYear = Math.floor((varIni + periods.length - 1) / 12) + 1999;
} else {
	var lastYear = Math.floor((varIni + periods.length - 1) / 12) + 2000;
}

var years = [];
for (i = firstYear; i <= lastYear; i++){
	years.push(i);
}

var months = ["E","F","M","A","M","J","J","A","S","O","N","D"];

function getDataset(n) {
	return data[0].map(function(d) {
		return {
			className: d.className,
			axes: d.axes.map(function(axis) {
				return {axis: axis.axis, value: axis.value[n]};
			})
		};
	});
}

var chart = RadarChart.chart();
var cfg = chart.config(); // retrieve default config
var svg = d3.select('body').append('svg')
	.attr('width', cfg.w  * 2 + 50)
	.attr('height', cfg.h + 100);

var label = svg.append("text")
    .attr("class", "year label")
    .attr("text-anchor", "middle")
    .attr("y", cfg.h + 60)
    .attr("x", cfg.w / 2)
    .text(function(){
		return getMonthYearText(varIni);
	});
	
function getMonthYearText(period){
	var m = period % 12;
	if (m == 0){
		m = 12;
	}
	return m + "/" + (Math.floor((period - 1) / 12) + 2000);
}

var ys = svg.selectAll("y")
			.data(years)
			.enter()
			.append("text")
			.attr("fill", '#ddd')
			.attr("font-size", function(){
				return Math.min((400 - (years.length) * 10) / (years.length + 1) - 6, 44);
			})
			.attr("text-anchor", "start")
			.attr("y", function(d, i) {
				return ((i + 1) * Math.min(cfg.h / years.length, 50) + 20);
			})
			.attr("x", cfg.w + 50)
			.text(function(d){
				return d;
			})
			.attr("cursor","context-menu");

			
pad = svg.selectAll('pad')
			.data(periods)
			.enter()
			.append('rect')
			.attr("fill","#ddd")
			.attr("x",function(d){
				return cfg.w + 50 + 100 + ((d - 1) % 12) * 25;
			})
			.attr("y", function(d){
				a = Math.floor(d / 12) - Math.floor(varIni / 12);
				if (d % 12 == 0){
					a = a - 1;
				}
				return a * Math.min(50, cfg.h / years.length) + 25;
			})
			.attr("width", 23)
			.attr("height", function(d){
				return Math.min(48, cfg.h / years.length - 2);
			})
			.on("mouseenter",function(d){
				d3.select(this).attr("fill", '#aaa');
				notInterrupted = false;
				return renderMonth(d);
			})
			.on("mouseleave",function(){
				d3.select(this).attr("fill", '#ddd')
			});

function renderMonth(n){
	label.text(getMonthYearText(n));
	return render(n - varIni);
}

chart.config({w: cfg.w, h: cfg.h, axisText: true, levels: 5, circles: true});
cfg = chart.config();

function render(n) {
  var game = svg.selectAll('g.game').data([getDataset(n)]);
	game.enter().append('g').classed('game', 1);
	game.call(chart);
}

render(0);

</script>
